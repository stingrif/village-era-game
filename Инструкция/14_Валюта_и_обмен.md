# Валюта и обмен

## Курсы ⭐ ↔ 💎 (оба варианта из спеки)

### Вариант 1 (рекомендованный в части текстов)

- **10 000 ⭐ = 10 💎** → 1 💎 = 1 000 ⭐  
- Обратно: **10 💎 = 6 000 ⭐** (хуже, анти-арбитраж)  

### Вариант 2 (жёсткий баланс)

- **250 ⭐ = 1 💎** (лимит 10 💎/день из ⭐)  
- **1 💎 = 220 ⭐** (лимит 2 000 ⭐/день из 💎)  

Выбор варианта — в конфиге exchange_rates. Комиссия обмена ~3% (сгорает) против кругового арбитража.

## Лимиты (пример)

- ⭐ → 💎: max 10 💎/день  
- 💎 → ⭐: max 2 000 ⭐/день  

## Курс монет и TON (для маркета/профиля)

- **1 TON = 320 монет** — курс для отображения эквивалента в маркете и профиле (из конфига, например COIN_TO_TON или POINTS_PER_TON).

## Цены в 💎 и ⭐ (примеры)

| Услуга | 💎 | ⭐ (пример) |
|--------|-----|-------------|
| +3 попытки шахты | 10 | 12 000 |
| Чекин «сейчас» | 15 | 18 000 |
| Подсказка 1 ячейки | 5 | 6 000 |
| Полное сканирование | 15 | 18 000 |
| Феникс Глаз | 25 | 30 000 |

Эквивалент в ⭐ обычно на 15–20% хуже, чтобы не было выгоды только гринда ⭐.

## Таблицы

- **currencies** — code (STARS, DIAMONDS, COINS, TON), kind (soft|premium|onchain)  
- **user_balances** — user_id, currency, balance  
- **exchange_rates** — from_currency, to_currency, rate, fee_pct  

## Функция

- **exchange_currency**(user_id, from, to, from_amount, idem_key) — обмен с проверкой баланса и проводками в economy_ledger.
