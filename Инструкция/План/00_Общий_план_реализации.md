# –û–±—â–∏–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø–æ –∑–∞–¥–∞—á–∞–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —à–ª—é–∑–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏** —Ç–µ–∫—É—â–µ–π —Ñ–∞–∑—ã. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ —Å [06_–ü—Ä–∞–≤–∏–ª–∞_–ø—Ä–æ–≤–µ—Ä–∫–∏_–¥–ª—è_–ò–ò](../–°–µ—Ä–≤–∏—Å—ã/06_–ü—Ä–∞–≤–∏–ª–∞_–ø—Ä–æ–≤–µ—Ä–∫–∏_–¥–ª—è_–ò–ò.md) –∏ [.cursorrules](../../.cursorrules).

---

## –ü—Ä–∏–Ω—Ü–∏–ø ¬´—à–ª—é–∑ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏¬ª

- **–®–ª—é–∑:** –∑–∞–ø—É—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (API, —Ñ—Ä–æ–Ω—Ç, –¥–µ–ø–ª–æ–π); –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–µ–ª—ë–Ω—ã–º–∏.
- **–ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ:** –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É, —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏; **–Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–∏–º –∑–∞–¥–∞—á–∞–º** –¥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è.
- –í—ã—Ö–æ–¥ –∏–∑ —Ü–∏–∫–ª–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ø—É—Å—Ç–∏–º **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ, smoke –ø—Ä–æ–π–¥–µ–Ω, –¥–µ–ø–ª–æ–π –æ—Ç–≤–µ—á–∞–µ—Ç).

---

## –§–∞–∑–∞ 0. –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è: —Ç–µ—Å—Ç—ã –∏ –±–∞–∑–æ–≤–∞—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

**–ó–∞–¥–∞—á–∏:**

- [x] 1. –ü—Ä–∏–≤–µ—Å—Ç–∏ –æ—Ç–≤–µ—Ç API `POST /api/game/mine/dig` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —Ç–µ—Å—Ç–æ–º: –≤ –æ—Ç–≤–µ—Ç–µ –ø–æ–ª–µ `opened_cells`.
- [x] 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –±—ç–∫–µ–Ω–¥–∞ (`pytest tests/`); —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –ø–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è.
- [x] 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–¥—ä—ë–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: –≥–ª–∞–≤–Ω–∞—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, —á–µ–∫–∏–Ω/—à–∞—Ö—Ç–∞ –æ—Ç–≤–µ—á–∞—é—Ç –ø–æ API.
- [x] 4. –û–±–Ω–æ–≤–∏—Ç—å –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï_–ê–†–•–ò–¢–ï–ö–¢–£–†–ï –∏ 28_–°—Ç–∞—Ç—É—Å_–∏_–∑–∞–¥–∞—á–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º.

**‚úÖ –®–ª—é–∑ –§–∞–∑—ã 0 –ø—Ä–æ–π–¥–µ–Ω:** –≤—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ; GET /api/game/config –∏ POST /api/game/checkin –æ—Ç–≤–µ—á–∞—é—Ç –æ–∂–∏–¥–∞–µ–º–æ.

---

## –§–∞–∑–∞ 1. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Å–µ–∫—Ä–µ—Ç–æ–≤

**–ó–∞–¥–∞—á–∏:**

- [x] 1. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É —Å–µ—Ä–≤–∏—Å–∞ `–ò–≥—Ä–∞/—Å–µ—Ä–≤–∏—Å—ã/secrets/`.
- [x] 2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API –ø–æ [04_–°–µ—Ä–≤–∏—Å_—Å–µ–∫—Ä–µ—Ç–æ–≤](../–°–µ—Ä–≤–∏—Å—ã/04_–°–µ—Ä–≤–∏—Å_—Å–µ–∫—Ä–µ—Ç–æ–≤.md): GET /secret?key=... —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º X-Internal-Token; –æ—Ç–≤–µ—Ç `{"value": "..."}` –∏–ª–∏ 403/404. –ü–æ—Ä—Ç 8003.
- [x] 3. –•—Ä–∞–Ω–µ–Ω–∏–µ: —á—Ç–µ–Ω–∏–µ –∏–∑ os.environ –ø–æ –∏–º–µ–Ω–∞–º –≤ `SECRET_KEYS`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏–∑ `SECRETS_FILE`. –ó–Ω–∞—á–µ–Ω–∏—è –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è.
- [x] 4. Dockerfile –∏ requirements.txt –≤ –ø–∞–ø–∫–µ —Å–µ—Ä–≤–∏—Å–∞ (python:3.12-slim, uvicorn).
- [x] 5. –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å –≤ docker-compose.149.yml; –ø–æ—Ä—Ç 8003, env_file: .env.secrets.
- [x] 6. env.secrets.example —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏: SECRETS_INTERNAL_TOKEN, SECRET_KEYS, INTERNAL_API_SECRET, TELEGRAM_BOT_TOKEN, SESSION_SIGNING_KEY.
- [x] 7. **–®–ª—é–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏:** –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä secrets –∑–∞–ø—É—â–µ–Ω; GET /health ‚Üí 200; GET /secret?key=TELEGRAM_BOT_TOKEN —Å –≤–µ—Ä–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º ‚Üí 200 (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ verify_after_deploy.sh –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ SECRETS_INTERNAL_TOKEN).

**–®–ª—é–∑ –§–∞–∑—ã 1:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä secrets –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è; –∑–∞–ø—Ä–æ—Å –∫ /secret —Å –≤–∞–ª–∏–¥–Ω—ã–º key –∏ —Ç–æ–∫–µ–Ω–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 –∏ value.

---

## –§–∞–∑–∞ 2. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ó–∞–¥–∞—á–∏:**

- [x] 1. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É —Å–µ—Ä–≤–∏—Å–∞ `–ò–≥—Ä–∞/—Å–µ—Ä–≤–∏—Å—ã/auth/`.
- [x] 2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å POST /verify: —Ç–µ–ª–æ `{"init_data": str}` (Telegram initData); –ø—Ä–æ–≤–µ—Ä–∫–∞ HMAC-SHA256 –ø–æ–¥–ø–∏—Å–∏; –ø—Ä–∏ —É—Å–ø–µ—Ö–µ ‚Äî `{"user_id": int}` —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ internal ensure-user; –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî 401.
- [x] 3. –ü–æ–ª—É—á–µ–Ω–∏–µ TELEGRAM_BOT_TOKEN –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ ‚Äî –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ (SECRETS_SERVICE_URL, INTERNAL_TOKEN).
- [x] 4. Dockerfile, requirements (fastapi, uvicorn, httpx, pydantic), –ø–æ—Ä—Ç 8001; –¥–æ–±–∞–≤–∏—Ç—å –≤ docker-compose.
- [x] 5. test_verify.py —Å —Ä—É—á–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π init_data ‚Üí 401).
- [x] 6. **–®–ª—é–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏:** GET /health ‚Üí 200; POST /verify —Å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º init_data ‚Üí 401 (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ verify_after_deploy.sh; –ø—Ä–∏ TELEGRAM_BOT_TOKEN –≤ env ‚Äî –Ω–µ 500).

**–®–ª—é–∑ –§–∞–∑—ã 2:** –°–µ—Ä–≤–∏—Å auth –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /verify; –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º init_data ‚Äî 401 (–∏–ª–∏ 500 –µ—Å–ª–∏ secrets –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω); GET /health ‚Üí 200.

---

## –§–∞–∑–∞ 3. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Å–µ—Å—Å–∏–π

**–ó–∞–¥–∞—á–∏:**

- [x] 1. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É —Å–µ—Ä–≤–∏—Å–∞ `–ò–≥—Ä–∞/—Å–µ—Ä–≤–∏—Å—ã/sessions/`.
- [x] 2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ [02_–°–µ—Ä–≤–∏—Å_—Å–µ—Å—Å–∏–π](../–°–µ—Ä–≤–∏—Å—ã/02_–°–µ—Ä–≤–∏—Å_—Å–µ—Å—Å–∏–π.md): POST /session (—Å–æ–∑–¥–∞—Ç—å), POST /session/refresh, POST /session/invalidate, GET /session/validate. –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis (–∫–ª—é—á–∏ —Å TTL).
- [x] 3. –ö–ª—é—á –ø–æ–¥–ø–∏—Å–∏ (SESSION_SIGNING_KEY) –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —É —Å–µ—Ä–≤–∏—Å–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
- [x] 4. Dockerfile, requirements (fastapi, uvicorn, redis, httpx), –ø–æ—Ä—Ç 8002; –¥–æ–±–∞–≤–∏—Ç—å –≤ docker-compose.
- [x] 5. test_sessions.py —Å —Ä—É—á–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏.
- [x] 6. **–®–ª—é–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏:** POST /session ‚Üí session_id; GET /session/validate ‚Üí valid; GET /health ‚Üí 200 (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ verify_after_deploy.sh).

**–®–ª—é–∑ –§–∞–∑—ã 3:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç session_id; validate –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç user_id –ø—Ä–∏ –≤–∞–ª–∏–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏; invalidate –¥–µ–ª–∞–µ—Ç —Å–µ—Å—Å–∏—é –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–π.

---

## –§–∞–∑–∞ 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±—ç–∫–µ–Ω–¥–∞ –ò–≥—Ä–∞ —Å Auth –∏ Sessions (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ó–∞–¥–∞—á–∏:**

- [x] 1. **–†–µ—à–µ–Ω–∏–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ:** –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É (auth –ø–æ telegram_id –≤ –±—ç–∫–µ–Ω–¥–µ app). –§–∞–∑–∞ –ø–æ–º–µ—á–µ–Ω–∞ ¬´—á–∞—Å—Ç–∏—á–Ω—ã–π –ø—Ä–æ–ø—É—Å–∫¬ª.
- [x] 2. *–ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏*: –¥–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–∑–µ—Ü ‚Äî AuthInitMiddleware: –ø—Ä–∏ –∑–∞–≥–æ–ª–æ–≤–∫–µ X-Telegram-Init-Data –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è Auth /verify, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è X-Telegram-User-Id (AUTH_SERVICE_URL –≤ env app).
- [x] 3. *–ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏*: SessionResolveMiddleware —É–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç Sessions /session/validate –ø—Ä–∏ X-Session-Id (SESSIONS_SERVICE_URL).
- [x] 4. –ö–æ–Ω—Ñ–∏–≥: AUTH_SERVICE_URL=http://auth:8001, SESSIONS_SERVICE_URL=http://sessions:8002 –ø—Ä–æ–ø–∏—Å–∞–Ω—ã –≤ docker-compose.

**–®–ª—é–∑ –§–∞–∑—ã 4:** –¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞; –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏. –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Äî –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Å–ø—Ä–∏–Ω—Ç–µ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## –§–∞–∑–∞ 5. –¢–∏–≥—Ä–∏—Ç: –æ–±—â–∏–π —Å–ª–æ–π –∏ –≤–µ–±-API

**–ó–∞–¥–∞—á–∏:**

- [x] 1. –ü–∞–∫–µ—Ç tigrit_shared: db.py (–ø—É–ª asyncpg, query_one, query_all, execute), read.py (get_village_row, get_top_users, get_recent_events, get_active_events).
- [x] 2. –ë–æ—Ç –¢–∏–≥—Ä–∏—Ç: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ tigrit_shared; db_async ‚Äî ensure_user, ensure_tigrit_profile, –∑–∞–ø–∏—Å—å –≤ tigrit_*.
- [x] 3. –í–µ–±-API –¢–∏–≥—Ä–∏—Ç: async, PostgreSQL; GET /api/village, /api/users, /api/events, /api/health, /api/zones, /api/items-catalog, POST /api/chat/message.
- [x] 4. –§—Ä–æ–Ω—Ç –¢–∏–≥—Ä–∏—Ç: API_URL = `/api` (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π).
- [x] 5. –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–∞; –¥–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL.

**‚úÖ –®–ª—é–∑ –§–∞–∑—ã 5 –ø—Ä–æ–π–¥–µ–Ω.**

---

## –§–∞–∑–∞ 6. –¢–∏–≥—Ä–∏—Ç: –¥–µ–ø–ª–æ–π –≤–µ–± (tigrit-api, tigrit-web, nginx)

**–ó–∞–¥–∞—á–∏:**

- [x] 1. Dockerfile tigrit_api (Python + tigrit_shared + backend + migrations). Dockerfile tigrit_web (nginx + dist).
- [x] 2. docker-compose: —Å–µ—Ä–≤–∏—Å—ã tigrit-api –∏ tigrit-web; DATABASE_URL –∏–∑ env_file; —Å–µ—Ç—å game.
- [x] 3. nginx-docker.conf: server –¥–ª—è tigrit.stakingphxpw.com; proxy X-Admin-Key –∏ X-API-Key.
- [x] 4. –í—Å–µ smoke –ø—Ä–æ–π–¥–µ–Ω—ã —á–µ—Ä–µ–∑ verify_after_deploy.sh (10 –ø—Ä–æ–≤–µ—Ä–æ–∫, –≤—Å–µ OK).

**‚úÖ –®–ª—é–∑ –§–∞–∑—ã 6 –ø—Ä–æ–π–¥–µ–Ω.**

---

## –§–∞–∑–∞ 6.1. –ü–æ–ª–Ω–æ–µ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¢–∏–≥—Ä–∏—Ç

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**

- [x] 1. tigrit_shared/read.py: `get_active_events(limit)` –∏–∑ `tigrit_events`.
- [x] 2. Backend data: tile_data.json, building_data.json, character_data.json, village_map.json (32√ó32).
- [x] 3. API: /api/assets, /api/map, /api/events/active, /api/zones (6 –∑–æ–Ω), /api/items-catalog (122 –ø—Ä–µ–¥–º–µ—Ç–∞).
- [x] 4. –§—Ä–æ–Ω—Ç: –∫–∞—Ä—Ç–∞ –ø–æ —Ü–≤–µ—Ç–∞–º –∞—Å—Å–µ—Ç–æ–≤, –∞–∫—Ç–∏–≤–Ω—ã–µ –∏–≤–µ–Ω—Ç—ã, –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞, –≤–∫–ª–∞–¥–∫–∞ ¬´–ü—Ä–µ–¥–º–µ—Ç—ã¬ª, –∑–æ–Ω—ã –Ω–∞ –∫–∞—Ä—Ç–µ.
- [x] 5. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–±–∑–¥–∞ ‚Üí deploy.

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (—Ç–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è):**

- [x] 6. **Admin API** (admin_routes.py): GET /api/admin/status, GET/PATCH /api/admin/village/{id}, POST /api/admin/village/{id}/activate, GET /api/admin/users?search=, GET/PATCH /api/admin/user/{id}. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è X-Admin-Key.
- [x] 7. **–†–µ–∂–∏–º –≤–∏–¥–∞** (viewMode): –∫–Ω–æ–ø–∫–∞ TOP‚Üî3RD –¥–ª—è –≤—Å–µ—Ö –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ; WASD-–¥–≤–∏–∂–µ–Ω–∏–µ; –º–∞–Ω–∞ —Å —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏ –∫—É–ª–¥–∞—É–Ω–∞–º–∏; –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
- [x] 8. **–ö–∞—Ä—Ç–∞ –¥–µ—Ä–µ–≤–Ω–∏**: initVillageScene –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ mounted() –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–∫–∏.
- [x] 9. **–†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç—ã**: –∫–Ω–æ–ø–∫–∞ üßπ –õ–∞—Å—Ç–∏–∫ (erase-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç), —Å—á—ë—Ç—á–∏–∫ —Ç–∞–π–ª–æ–≤; saveMap disabled –±–µ–∑ Editor API Key + confirm-–¥–∏–∞–ª–æ–≥.
- [x] 10. **SQL-–º–∏–≥—Ä–∞—Ü–∏–∏**: 001_tigrit_village_extend.sql (name/xp/population_max), 002_tigrit_interactions_ensure.sql; run_migrations.py –∞–≤—Ç–æ-–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ lifespan().
- [x] 11. **–ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞** (debounce 300ms), –±–∞–Ω–Ω–µ—Ä API-–æ—à–∏–±–∫–∏ + –∫—ç—à localStorage.
- [x] 12. **Responsive design**: –ø–æ–ª–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω (‚â§640px) –∏ –ø–ª–∞–Ω—à–µ—Ç (‚â§1024px); scrollable nav, touch-friendly tap-targets, bottom-sheet –º–æ–¥–∞–ª—å, viewport-fit=cover –¥–ª—è Telegram Mini App.
- [x] 13. **write.py / read.py**: MissingColumnError ‚Üí 422 —Å hint; COALESCE fallback –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫.
- [x] 14. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: 29_–†–µ–∂–∏–º_—Ç—Ä–µ—Ç—å–µ–≥–æ_–ª–∏—Ü–∞.md, 30_Admin_API_–¢–∏–≥—Ä–∏—Ç.md, –æ–±–Ω–æ–≤–ª—ë–Ω 00_–û–ì–õ–ê–í–õ–ï–ù–ò–ï.md.

**‚úÖ –®–ª—é–∑ –§–∞–∑—ã 6.1 –ø—Ä–æ–π–¥–µ–Ω** (smoke verify_after_deploy.sh ‚Äî 10/10 OK).

---

## –§–∞–∑–∞ 7. –î–µ–ø–ª–æ–π –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (149 / –ø—Ä–æ–¥)

**–ó–∞–¥–∞—á–∏:**

- [x] 1. Caddy –Ω–∞ 192.168.1.149 –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç tigrit.stakingphxpw.com ‚Üí nginx:8081; caddy-tigrit.conf.example –∞–∫—Ç—É–∞–ª–µ–Ω.
- [x] 2. upload_to_149_docker.sh / deploy_docker_on_149.sh; –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Up: app, api-gateway, health, tigrit-bot, tigrit-api, tigrit-web, redis.
- [x] 3. Smoke: https://stakingphxpw.com ‚Äî –∏–≥—Ä–∞; https://tigrit.stakingphxpw.com ‚Äî –≤–µ–± –¢–∏–≥—Ä–∏—Ç (–≤—Å–µ 10 –ø—Ä–æ–≤–µ—Ä–æ–∫ OK).
- [x] 4. README_DOCKER_149.md –∏ deploy/README.md –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–Ω–æ–≤—ã–µ env, –º–∏–≥—Ä–∞—Ü–∏–∏, Admin-–≤–∫–ª–∞–¥–∫–∞).
- [x] 5. **–ù–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** (secrets, auth, sessions): –≤ docker-compose.149.yml; .env.secrets –ø–æ env.secrets.example –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ; GET /health –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ verify_after_deploy.sh.

**–®–ª—é–∑ –§–∞–∑—ã 7:** –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Up; smoke –ø—Ä–æ–π–¥–µ–Ω; –Ω–æ–≤—ã–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ /health.

---

## –§–∞–∑–∞ 8. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à–ª—é–∑

**–ó–∞–¥–∞—á–∏:**

- [x] 1. 25_–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.md: –¥–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫–∏ Auth, Sessions, Secrets –≤ –¥–∏–∞–≥—Ä–∞–º–º—É.
- [x] 2. 18_Dev_—Ç–∞–±–ª–∏—Ü—ã_–∏_—Ñ–æ—Ä–º—É–ª—ã.md: –æ–±–Ω–æ–≤–ª—ë–Ω –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º –∏ –ø–æ–ª—è–º.
- [x] 3. –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï_–ê–†–•–ò–¢–ï–ö–¢–£–†–ï: –æ—Ç–º–µ—Ç–∏—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã.
- [x] 4. 28_–°—Ç–∞—Ç—É—Å_–∏_–∑–∞–¥–∞—á–∏: –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ, –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–µ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ.
- [x] 5. **–û–±–Ω–æ–≤–∏—Ç—å** 25_–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.md: –¥–æ–±–∞–≤–ª–µ–Ω—ã Admin API, Survival MMO, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã, responsive –≤ —Ç–∞–±–ª–∏—Ü—É –æ–±–∑–æ—Ä–∞.
- [x] 6. **–§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç**: —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ ‚Äî `chore: phases 1-7.5 complete ‚Äî services, admin API, responsive, survival MMO, Auth/Sessions integration` (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ —Ä–µ–ª–∏–∑–µ).

**–§–∏–Ω–∞–ª—å–Ω—ã–π —à–ª—é–∑ (—É—Å–ª–æ–≤–∏–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ü–∏–∫–ª–∞):**

- –ü–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω —Ç–µ—Å—Ç–æ–≤ –±—ç–∫–µ–Ω–¥–∞: –≤—Å–µ –∑–µ–ª—ë–Ω—ã–µ.
- Smoke: –≤—Å–µ 10 –ø—Ä–æ–≤–µ—Ä–æ–∫ OK + /health —Ç—Ä—ë—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.
- –î–µ–ø–ª–æ–π: –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Up; —Å–∞–π—Ç –∏ –ø–æ–¥–¥–æ–º–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è; –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç.

**–ü–ª–∞–Ω —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —à–ª—é–∑–∞.**

---

## –§–∞–∑–∞ 7.5. Survival MMO (—Å–ª–æ–∏ A‚ÄìE)

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**

- [x] –°–ª–æ–π A: –∑–æ–Ω—ã –∏–∑ –ë–î (003), zone/bind, zone/change, player/status; –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ, ¬´–ü–æ—Å–µ–ª–∏—Ç—å—Å—è¬ª, dead_boredom.
- [x] –°–ª–æ–π B: –ª–æ–∫–∞—Ü–∏–∏ –∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è (004), travel/start|current|arrive, loot_tables, location/loot; boredom cron, respawn; travel-bar, ¬´–î–æ–±—ã—Ç—å¬ª.
- [x] –°–ª–æ–π C: –±–∞–∑—ã –∏ –∫–ª–∞–Ω—ã (005), allocate_base_position –ø—Ä–∏ bind; clan create/join/contribute/betray; –±–∞–∑—ã –Ω–∞ –∫–∞—Ä—Ç–µ, —Å–µ–∫—Ü–∏—è –ö–ª–∞–Ω.
- [x] –°–ª–æ–π D: trust (adjust_trust, —Ç—Ä–∏–≥–≥–µ—Ä—ã), –±–æ—Ç ‚Äî home_zone_first_activity_at; survival_reports (006), Admin reports; trust_decay; –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ trust.
- [x] –°–ª–æ–π E: raid_type=base –≤ POST /api/game/attack, combat_sessions (007), combat/action; —Ñ—Ä–æ–Ω—Ç: –†–µ–π–¥, HP-–±–∞—Ä—ã, –ª–æ–≥ –±–æ—è.
- [x] –î–µ–ø–ª–æ–π –Ω–∞ 149; verify_after_deploy.sh ‚Äî –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –≤–∫–ª—é—á–∞—è GET /api/survival/zones, locations, telegram/health.

**–®–ª—é–∑ –§–∞–∑—ã 7.5:** Smoke –ø—Ä–æ–π–¥–µ–Ω; survival-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Ç–≤–µ—á–∞—é—Ç 200.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∑—ã (–§–∞–∑–∞ 9 –∏ –¥–∞–ª–µ–µ)

- **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Auth/Sessions** –≤ –±—ç–∫–µ–Ω–¥ Village Era –∏ Tigrit API (–∑–∞—â–∏—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ —Å–µ—Å—Å–∏–∏).
- **–†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è 18_Dev:** dig_log, checkin_log –ø–æ–ª—è; —É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞; ads_rules, donation_rules –≤ –∫–æ–Ω—Ñ–∏–≥–µ.
- **–í—ã–≤–æ–¥ TON / –ë–ª–æ–∫—á–µ–π–Ω:** –∑–∞–≥–ª—É—à–∫–∏ iCryptoCheck –∏ TonAPI ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–∑—ã –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
- **–ö—Ä–æ–Ω-–∑–∞–¥–∞—á–∏:** —Å—Ç–µ–π–∫–∏–Ω–≥, –±–ª–æ–∫—á–µ–π–Ω, leaderboards ‚Äî —Ñ–∞–∑–∞ —Å –∑–∞–¥–∞—á–∞–º–∏ –∏ —à–ª—é–∑–æ–º.
- **Premium-–ø–æ–¥–ø–∏—Å–∫–∞ –∏ 3-–µ –ª–∏—Ü–æ:** —É–±—Ä–∞—Ç—å viewModeTest, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É hasSubscription.

–î–µ—Ç–∞–ª–∏ ‚Äî –≤ [28_–°—Ç–∞—Ç—É—Å_–∏_–∑–∞–¥–∞—á–∏](../28_–°—Ç–∞—Ç—É—Å_–∏_–∑–∞–¥–∞—á–∏.md) –∏ [–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï_–ê–†–•–ò–¢–ï–ö–¢–£–†–ï](../../–±—ç–∫–µ–Ω–¥/–°–û–û–¢–í–ï–¢–°–¢–í–ò–ï_–ê–†–•–ò–¢–ï–ö–¢–£–†–ï.md).

---

## –ß–µ–∫-–ª–∏—Å—Ç –≤—ã—Ö–æ–¥–∞

–ü–ª–∞–Ω –∑–∞–≤–µ—Ä—à—ë–Ω **—Ç–æ–ª—å–∫–æ –ø—Ä–∏**:

- [x] –í—Å–µ —Ç–µ—Å—Ç—ã –±—ç–∫–µ–Ω–¥–∞ –∑–µ–ª—ë–Ω—ã–µ.
- [x] Smoke-–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞ (10/10 verify_after_deploy.sh).
- [x] –î–µ–ø–ª–æ–π –≤ —Ü–µ–ª–µ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —Ä–∞–±–æ—á–∏–π (—Å–∞–π—Ç –∏ –ø–æ–¥–¥–æ–º–µ–Ω –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è).
- [x] –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã Up –≤–∫–ª—é—á–∞—è secrets, auth, sessions (–≤ compose; verify_after_deploy –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ).
- [x] –§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç: —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ (–ø–æ –∂–µ–ª–∞–Ω–∏—é ‚Äî —Ç–µ–≥ –≤–µ—Ä—Å–∏–∏ –≤—Ä—É—á–Ω—É—é).

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ–∞–∑ —Å–≤–µ—Ä—è—Ç—å—Å—è —Å [06_–ü—Ä–∞–≤–∏–ª–∞_–ø—Ä–æ–≤–µ—Ä–∫–∏_–¥–ª—è_–ò–ò](../–°–µ—Ä–≤–∏—Å—ã/06_–ü—Ä–∞–≤–∏–ª–∞_–ø—Ä–æ–≤–µ—Ä–∫–∏_–¥–ª—è_–ò–ò.md) –∏ —Å —ç—Ç–∏–º –ø–ª–∞–Ω–æ–º.
