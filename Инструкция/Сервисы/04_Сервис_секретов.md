# Сервис секретов

Микросервис выдаёт значения секретов по ключу доверенным вызывающим (по внутренней сети или с внутренним токеном). Не содержит бизнес-логики; только чтение и при необходимости кэш из хранилища (env, файл, vault). К нему обращаются сервисы Auth и Sessions; при необходимости — бэкенд Игра (например для INTERNAL_API_SECRET).

---

## Назначение

- Централизованное хранение или прокси к секретам: ключи подписей (JWT, сессий), INTERNAL_API_SECRET, TELEGRAM_BOT_TOKEN для проверки initData и т.д.
- Единственный контракт: запрос по имени ключа → ответ со значением (или 403/404 при отсутствии доступа/ключа).
- Снижение дублирования секретов в env каждого сервиса; один источник правды для имён и доступа.

---

## Контракт API (эндпоинты)

Базовый URL задаётся в конфигурации вызывающих (env). Доступ только из внутренней сети или с заголовком/токеном, проверяемым сервисом.

| Метод | Путь | Назначение | Заголовки / Query | Ответ |
|-------|------|------------|-------------------|--------|
| GET | /secret | Получить значение по ключу | Query: `key=INTERNAL_API_SECRET` (или иной ключ). Заголовок `X-Internal-Token` (или иной) для проверки вызывающего. | `{"value": str}` или 403/404 |

Коды: 400 — не указан key; 403 — нет прав на этот ключ или неверный токен; 404 — ключ не найден; 500 — внутренняя ошибка.

Список допустимых ключей и политика доступа (кто какой ключ может запрашивать) задаются конфигурацией сервиса и при необходимости описываются в этом документе.

---

## Кто вызывает

- **Сервис авторизации:** ключи для проверки подписи (Telegram, JWT).
- **Сервис сессий:** ключ для подписи сессий (SESSION_SIGNING_KEY).
- **Бэкенд Игра (опционально):** INTERNAL_API_SECRET для internal эндпоинтов, если решено не хранить его в env app.

Сервис секретов никого не вызывает; только отдаёт значения.

---

## Хранилище секретов

- **Вариант A:** Переменные окружения (os.environ) — ключ = имя переменной, значение = значение. Подходит для старта.
- **Вариант B:** Файл (например JSON или .env) в защищённом томе; сервис читает при старте и кэширует.
- **Вариант C:** Внешний vault (HashiCorp Vault и т.п.); сервис — тонкая обёртка над API vault.

Выбор и схема — в папке сервиса. БД для хранения секретов на первом этапе не обязательна.

---

## Папка в репозитории

Один сервис — одна папка. Например: `Игра/сервисы/secrets/` или `Игра/deploy/secrets/`. Внутри: минимальное приложение (FastAPI/Flask), Dockerfile, requirements.txt. Секреты в контейнер передаются через env или смонтированный файл; сервис не обращается к другим микросервисам.

---

## Переменные окружения (env)

- `INTERNAL_TOKEN` — значение, которое должны передавать вызывающие в заголовке для доступа к /secret (или отключение проверки только для внутренней сети).
- Собственно секреты: либо перечислены как env (KEY_NAME=value), либо путь к файлу `SECRETS_FILE=/path/to/secrets.json`.
- Порт приложения (например `PORT=8000`).

Сервис не логирует значения секретов и не отдаёт их в ответах с лишними полями.
