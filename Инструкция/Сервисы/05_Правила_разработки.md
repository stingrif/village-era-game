# Правила разработки

Обязательные принципы при написании и изменении кода в проекте. Ссылка на общую архитектуру: [25_Архитектура.md](../25_Архитектура.md). Детали механик — в документах 01–28 в [Инструкция](../).

---

## ООП и структура

- Сущности предметной области оформлять в виде классов с чёткой ответственностью; не размазывать логику по процедурам.
- Зависимости передавать явно (конструктор, DI), не тянуть глобальные объекты из неочевидных мест.
- Интерфейсы (контракты) — явные: что сервис принимает и возвращает, документировать в Инструкции (Сервисы 02–04).

---

## Правило 80/20

- 80% результата — минимальным изменением; не усложнять без необходимости.
- Новые сущности и файлы вводить только когда повторение превышает порог (например 2+ использования) или когда без этого нарушается разделение обязанностей.

---

## Чистота кода (по Р. Мартину «Чистый код»)

- Имена переменных, функций и классов — говорящие; без аббревиатур, кроме общепринятых.
- Функции и методы — короткие, одна задача; уровень абстракции внутри функции — один.
- Комментарии — только там, где код не может объяснить себя сам; описание «зачем», а не «что».
- Дублирование устранять выносом в функцию/модуль; копипаст не допускается после второго использования.
- Обработка ошибок явная; не глотать исключения без логирования и не возвращать «тихо» неверный результат.

---

## Один сервис — одна папка

- Вся логика микросервиса (auth, sessions, secrets) — в своей папке: код, конфиг, Dockerfile, зависимости.
- Общее между сервисами — только контракт (URL, формат запроса/ответа), описанный в [01_Архитектура_микросервисов.md](01_Архитектура_микросервисов.md) и 02–04.
- Не создавать общих «менеджеров» и оркестраторов; каждый сервис обращается только к тому, кто по контракту решает задачу.

---

## Разделение обязанностей и запрет дублирования

- Одна сущность (класс, модуль, сервис) — одна зона ответственности.
- Логика «кто пользователь» — только в сервисе авторизации; логика «сессия валидна» — только в сервисе сессий; выдача секретов — только в сервисе секретов.
- Не дублировать SQL, проверки и форматы между сервисами; общие данные — через API или общую БД по документации 18_Dev и 25_Архитектура.

---

## Не плодить лишние файлы

- Не создавать файлы «на будущее» и пустые заглушки без задачи.
- Структура папок плоская или с одним уровнем вложенности, если иначе не обосновано (например api/, core/, infrastructure/ в бэкенде уже закреплены).
- Документация — в Инструкции (01–28 и Сервисы 00–06); не дублировать одни и те же правила в нескольких местах; при изменении — обновлять один источник.

---

## Актуальность

- При изменении контракта API сервиса — обновлять соответствующий документ в Сервисы (02–04) и при необходимости 01.
- При добавлении таблиц или полей — обновлять 18_Dev и при необходимости механики (01–28).
- Статус реализации и задачи — в [28_Статус_и_задачи.md](../28_Статус_и_задачи.md).

Сверка с этими правилами — перед коммитом и при код-ревью. Для ассистента (ИИ) дополнительно действуют [06_Правила_проверки_для_ИИ.md](06_Правила_проверки_для_ИИ.md).
