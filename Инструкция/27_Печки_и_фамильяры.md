# Печки и фамильяры

## Печка = ключ по цвету

Один тип предмета — «печка» (furnace), **6 вариантов по цвету яиц:** red, green, blue, yellow, purple, black (из палитры eggs_def).

- В `item_defs`: например `furnace_red`, …, `item_type=furnace`, `subtype` = цвет.

## Использование печки (вылупление)

- **1 печка** + **3 обычных яйца** того же цвета **или** **1 редкое/крутое яйцо** того же цвета → «вылупление».
- Потребляются печка и яйца; розыгрыш результата по пулу для данного цвета/редкости яиц.
- **Типы дропа при вылуплении:** обычный лут (ресурсы/реликвия) или **фамильяр** (питомец). Пул задаётся в `egg_hatch_pool` — см. [18_Dev_таблицы_и_формулы.md](18_Dev_таблицы_и_формулы.md).

## Фамильяры (Familiars)

- Сущность: `item_type=familiar` в `item_defs` (или таблица `familiars_def`: id, key, name, passive_buff_json, extra_abilities).
- **user_familiars:** user_id, familiar_def_id, equipped, acquired_at. Пассивные бафы применяются через user_effects или по флагу «имеет фамильяра X» при расчёте формул (доход, защита, шансы).
- Вылупление в печке с некоторым шансом даёт запись в `user_familiars` или предмет типа familiar в инвентаре.

## Донаты и шанс «крутой» печки

При донате (запись в `donations`) пользователю на 24 часа устанавливается бонус: следующая печка, выпавшая в призовой ячейке шахты, выдаётся с меткой «улучшенная» (meta improved). Улучшенная печка даёт повышенный шанс фамильяра при вылуплении (настраивается в effects_json/конфиге).

## Мастерская — апгрейд печки

- **Рецепт:** 2 печки одного цвета + просмотр рекламы + 1 любой предмет.
- **Результат:** 1 печка того же цвета с повышенной редкостью/шансом (meta improved).
- Требуется здание **workshop** у игрока. API: **POST** `/api/game/craft/furnace-upgrade` (body: furnace_item_id_1, furnace_item_id_2, extra_item_id, ad_watched).

Таблицы: `familiars_def`, `user_familiars`, `egg_hatch_pool` — [18_Dev_таблицы_и_формулы.md](18_Dev_таблицы_и_формулы.md). Шахта и яйца — [03_Шахта_и_яйца.md](03_Шахта_и_яйца.md).
