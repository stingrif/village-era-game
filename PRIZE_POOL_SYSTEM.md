# Система пула наград с заморозкой и выводом

Концепция призового пула: формирование из нескольких источников, распределение только топ-5, 50% награды сразу / 50% заморожено до следующего цикла, разблокировка по рангу в следующем турнире. **Вход в пулы — в токене проекта PHXPW (не TON).**

---

## Оговорка по валюте входа

- **Взнос за участие в турнире:** не в TON, а в **токене проекта PHXPW**.
- **Стартовая сумма входа:** **30 000 PHXPW** (низкий порог входа).
- **Оплата:** в нашем токене (PHXPW/PHOEX) или в **партнёрских токенах**, перечень которых задаётся в **env** (адреса/символы партнёрских токенов для приёма взносов).
- **Цена для пересчёта:** фиксируем курс PHXPW в TON (например **0.00002412 TON за 1 PHXPW** на момент запуска). Все остальные суммы в спецификации (пул, призы, лимиты) задаются в **долларовом эквиваленте** к этой установленной цене.

Пример: 30 000 PHXPW × 0.00002412 TON ≈ **0,72 TON** за вход (при текущем курсе).

---

## Переменные окружения (env)

Используются в бэкенде и при отображении в игре:

| Переменная | Описание | Пример |
|------------|----------|--------|
| `PRIZE_POOL_ENTRY_PHXPW` | Взнос за участие в турнире (в PHXPW) | `30000` |
| `PHXPW_PRICE_TON` | Курс 1 PHXPW в TON (для отображения и эквивалентов) | `0.00002412` |
| `PRIZE_POOL_PARTNER_TOKENS` | Список партнёрских токенов для оплаты взноса (адреса контрактов через запятую или JSON) | см. env.example |
| `TON_USD_RATE` или аналог | Курс TON/USD для перевода в долларовый эквивалент (опционально) | по API или фикс |

Партнёрские токены: те, что указаны в env (например, адреса пулов/токенов из `STONFI_POOL_ADDRESS`, `DEDUST_POOL_ADDRESS` и т.д.). Эквивалент 30 000 PHXPW в партнёрском токене считается по установленной цене.

---

## Формирование пула наград

```javascript
const PRIZE_POOL_SYSTEM = {
  poolSources: {
    // 1. Взносы на турнир (в PHXPW или партнёрских токенах)
    tournamentFees: {
      entryFee: 30000,                // 30 000 PHXPW за участие (не 5 TON!)
      entryFeeTONEquivalent: 0.72,    // ~0.72 TON при 0.00002412 TON/PHXPW
      participantsPerWeek: 200,
      weeklyIncomePHXPW: 200 * 30000, // 6 000 000 PHXPW
      poolContribution: 0.70,
      toPrizePool: 0.70 * 6_000_000   // в PHXPW; в USD — по установленной цене
    },

    // 2. Комиссии с рынка (в долларовом эквиваленте)
    marketCommissions: {
      weeklyCommissionsUSD: 500,
      poolContribution: 0.30,
      toPrizePoolUSD: 150
    },

    // 3. Налоги с продаж
    sellTaxes: {
      weeklyTaxesUSD: 1500,
      poolContribution: 0.20,
      toPrizePoolUSD: 300
    },

    // 4. Донаты игроков (добровольные, в PHXPW/партнёрских/TON — по env)
    playerDonations: {
      poolContribution: 1.00,
      toPrizePool: 200  // USD эквивалент
    },

    // 5. Взносы на ивенты (оплата в PHXPW или партнёрских токенах из env)
    eventFees: {
      weeklyEventsUSD: 300,
      poolContribution: 0.50,
      toPrizePoolUSD: 150
    },

    // ИТОГО: недельный пул в USD-эквиваленте по установленной цене
    weeklyTotalUSD: 700 + 150 + 300 + 200 + 150,  // = 1 500
    biweeklyTotalUSD: 1500 * 2,                   // = 3 000 за эру (2 недели)
    monthlyTotalUSD: 1500 * 4                    // = 6 000
  },

  // РАСПРЕДЕЛЕНИЕ (ТОП-5) — суммы в USD-эквиваленте
  prizeDistribution: {
    totalPoolUSD: 3000,
    places: {
      1: { percent: 0.40, amountUSD: 1200, frozen: 0.50, immediate: 600, locked: 600 },
      2: { percent: 0.25, amountUSD: 750,  frozen: 0.50, immediate: 375, locked: 375 },
      3: { percent: 0.15, amountUSD: 450,  frozen: 0.50, immediate: 225, locked: 225 },
      4: { percent: 0.10, amountUSD: 300,  frozen: 0.50, immediate: 150, locked: 150 },
      5: { percent: 0.10, amountUSD: 300,  frozen: 0.50, immediate: 150, locked: 150 }
    },
    immediatePayoutsUSD: 1500,
    frozenAmountUSD: 1500
  },

  // ЗАМОРОЗКА И РАЗБЛОКИРОВКА (без изменений логики)
  freezeSystem: {
    mechanics: {
      winPrize: 'Выиграл $1,200 за 1 место',
      immediate: '$600 доступно сразу',
      frozen: '$600 заморожено на следующий цикл',
      nextCycle: 'Через 2 недели — новый турнир',
      unlockCondition: 'Чтобы разморозить $600:',
      requirements: [
        '1. Снова попасть в топ-20',
        '2. Иметь уровень 3+',
        '3. Держать $250 токенов проекта (в эквиваленте)',
        '4. Подключен кошелёк'
      ]
    },
    unlockTiers: {
      top5Again:  { unlockPercent: 1.00, bonus: 0.20 },
      top20:      { unlockPercent: 0.75, bonus: 0 },
      top50:      { unlockPercent: 0.50, bonus: 0 },
      notInTop:   { unlockPercent: 0,   redistribution: 'В следующий пул' }
    }
  },

  // УСЛОВИЯ ВЫВОДА ЗАМОРОЖЕННЫХ
  withdrawalConditions: {
    basic: {
      minLevel: 3,
      topRequired: true,
      minRank: 50,
      tokenHoldingUSD: 250,           // $250 в токенах проекта (эквивалент)
      walletConnected: true,
      walletVerified: true
    },
    unlockLevels: {
      level3: { rank: 50,  unlockPercent: 0.50, delayDays: 14 },
      level4: { rank: 20,  unlockPercent: 0.75, delayDays: 7 },
      level5: { rank: 5,   unlockPercent: 1.00, bonus: 0.20, delayDays: 3 }
    },
    penalties: {
      noParticipation: 0.30,
      outOfTop: 1.00,
      levelDrop: 0.50,
      soldTokens: 0.40
    }
  }
};
```

---

## Схема работы (кратко)

1. **Участие:** игрок платит **30 000 PHXPW** (или эквивалент в партнёрском токене из env). Не 5 TON.
2. **Цена:** 1 PHXPW = `PHXPW_PRICE_TON` TON; долларовый эквивалент — по установленной цене (или TON/USD из env/API).
3. **Пул:** формируется из взносов (70%), комиссий рынка, налогов, донатов, ивентов. Итоги цикла — в USD-эквиваленте.
4. **Распределение:** только топ-5; 50% приза сразу, 50% заморожено.
5. **Разблокировка:** по рангу в следующем турнире (топ-5 снова → 100% + 20%; топ-20 → 75%; топ-50 → 50%; вне топа → 0%).
6. **Вывод:** уровень 3+, топ, $250 токенов, кошелёк; задержка по уровню (14 / 7 / 3 дня). Комиссия вывода 5%.

---

## Краткая схема (блок)

```
ВХОД В ПУЛЫ:
├─ Взнос: 30 000 PHXPW (или партнёрские токены из env)
├─ Не 5 TON — ставка в токене проекта
└─ Цена: PHXPW_PRICE_TON (напр. 0.00002412) → эквиваленты в USD по установленной цене

ПУЛ: взносы (70%) + комиссии + налоги + донаты + ивенты → неделя/цикл в USD-эквиваленте.

ТОП-5: 40% / 25% / 15% / 10% / 10% → 50% сразу, 50% заморозка.

РАЗМОРОЗКА: топ-5 снова 100%+20% | топ-20 75% | топ-50 50% | вне топа 0%.

ВЫВОД: L3+ топ-50 (14д) | L4+ топ-20 (7д) | L5 топ-5 (3д); $250 токенов + кошелёк; комиссия 5%.
```

---

## Связь с env

- **Взнос за турнир:** `PRIZE_POOL_ENTRY_PHXPW=30000`
- **Курс PHXPW:** `PHXPW_PRICE_TON=0.00002412`
- **Партнёрские токены для оплаты:** список в env (например `PRIZE_POOL_PARTNER_TOKENS` или использование существующих `*_POOL_*` / ссылок на своп из env).
- Остальные суммы в документации заданы в **долларовом эквиваленте** к установленной цене PHXPW/TON.
