# –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–¥–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (25_–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, 18_Dev)

–°–≤–æ–¥–∫–∞: —á—Ç–æ **—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** –∏ —á—Ç–æ **–µ—â—ë –Ω–µ—Ç** –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö.

---

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (25, 18_Dev)
| –≠–ª–µ–º–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|--------|--------|
| Master config (game.field, game.mine, game.eggs) | ‚úÖ `data/game_config.json`, –∑–∞–≥—Ä—É–∑–∫–∞ –≤ config.py |
| get_field_config(), get_mine_config(), get_eggs_config() | ‚úÖ |
| game_rules: checkin_rules, mine_rules | ‚úÖ CHECKIN_RULES, MINE_RULES –≤ config.py |
| GAME_CONFIG_PATH (env) | ‚úÖ |

### –ë–î ‚Äî –ø—Ä–æ–µ–∫—Ç—ã –∏ –º—É–ª—å—Ç–∏–ø—Ä–æ–¥—É–∫—Ç
| –≠–ª–µ–º–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|---------|--------|
| projects (id, code, name) | ‚úÖ —Å–∏–¥: (1, 'village_era', 'Village Era') |
| project_id –≤ admin_partner_tokens, admin_tasks, admin_page_texts | ‚úÖ UNIQUE –ø–æ (project_id, ‚Ä¶) |
| admin_channels (project_id, chat_id, title, channel_type, is_active, sort_order) | ‚úÖ –ø—Ä–∏–≤—è–∑–∫–∞ –∫–∞–Ω–∞–ª–æ–≤/—á–∞—Ç–æ–≤ –∫ –ø—Ä–æ–µ–∫—Ç—É |
| activity_log (project_id, user_id, telegram_id, channel_id, event_type, event_meta JSONB, created_at) | ‚úÖ –ª–æ–≥ —Å–æ–±—ã—Ç–∏–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ |
| user_activity_stats (user_id, project_id, total_messages_sent, total_reactions_received, reactions_by_type JSONB, last_activity_at) | ‚úÖ –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –ø—Ä–æ–µ–∫—Ç–µ |

–û–±—â–∞—è –±–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (users) —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ —á–µ—Ä–µ–∑ activity_log –∏ user_activity_stats; –æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ users –Ω–∞ –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è/–ø—Ä–æ–µ–∫—Ç—ã.

### –ë–î ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ —á–µ–∫–∏–Ω/—à–∞—Ö—Ç–∞
| –¢–∞–±–ª–∏—Ü–∞ | –°—Ç–∞—Ç—É—Å |
|---------|--------|
| users (id, telegram_id) | ‚úÖ |
| user_profile (ads_enabled, checkin_cd_bonus_*) | ‚úÖ |
| user_balances (user_id, currency, balance) | ‚úÖ |
| checkin_state | ‚úÖ |
| checkin_log | ‚úÖ (–Ω–µ—Ç –ø–æ–ª–µ–π ip_hash, device_hash, vpn_flag, risk_note ‚Äî —Å–º. —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è) |
| attempts_balance | ‚úÖ |
| mine_sessions (6√ó6, prize_cells, opened_cells) | ‚úÖ |
| dig_log | ‚úÖ (–Ω–µ—Ç ip_hash, device_hash, vpn_flag, egg_hit, drop_item_def_id, drop_rarity ‚Äî —Å–º. —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è) |
| economy_ledger (idem_key) | ‚úÖ |

### API (REST)
| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ –≤ –¥–æ–∫–µ | –°—Ç–∞—Ç—É—Å |
|----------|------------------|--------|
| GET /api/game/config | –ü—É–±–ª–∏—á–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ field, mine, eggs | ‚úÖ |
| POST /api/game/checkin | –ß–µ–∫–∏–Ω ‚Üí 3 –ø–æ–ø—ã—Ç–∫–∏, CD 10 —á | ‚úÖ |
| GET /api/game/checkin-state | next_checkin_at, streak | ‚úÖ |
| GET /api/game/attempts | –ë–∞–ª–∞–Ω—Å –ø–æ–ø—ã—Ç–æ–∫ | ‚úÖ |
| POST /api/game/mine/create | –°–æ–∑–¥–∞—Ç—å —à–∞—Ö—Ç—É ‚Üí mine_id | ‚úÖ |
| POST /api/game/mine/dig | –ö–æ–ø–∞—Ç—å —è—á–µ–π–∫—É, –¥—Ä–æ–ø (–º–æ–Ω–µ—Ç—ã), –≤ –æ—Ç–≤–µ—Ç–µ opened_cells | ‚úÖ |
| GET /api/game/mine/{id} | –°–µ—Å—Å–∏—è –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–∑–æ–≤—ã—Ö | ‚úÖ |
| GET /api/game/state | Legacy state | ‚úÖ |
| POST /api/game/action | collect, burn, phoenix_quest, sell, sync | ‚úÖ |

### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –∏ –¢–∏–≥—Ä–∏—Ç (–ø–ª–∞–Ω —Ñ–∞–∑ 1‚Äì6)
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| Secrets (GET /secret?key=..., X-Internal-Token) | ‚úÖ –ò–≥—Ä–∞/—Å–µ—Ä–≤–∏—Å—ã/secrets |
| Auth (POST /verify, init_data/token ‚Üí user_id) | ‚úÖ –ò–≥—Ä–∞/—Å–µ—Ä–≤–∏—Å—ã/auth |
| Sessions (POST /session, /refresh, /invalidate; GET /session/validate) | ‚úÖ –ò–≥—Ä–∞/—Å–µ—Ä–≤–∏—Å—ã/sessions |
| tigrit_shared (asyncpg, get_village_row, get_top_users, get_recent_events) | ‚úÖ –∫–∞–±–∑–¥–∞/tigrit_shared; –∫–æ–ø–∏–∏ –≤ deploy/tigrit_api, deploy/tigrit_bot |
| Tigrit –≤–µ–±-API (GET /api/village, /api/users, /api/events –∏–∑ PostgreSQL) | ‚úÖ –∫–∞–±–∑–¥–∞/tigrit_web/backend; deploy/tigrit_api |
| Tigrit –≤–µ–±-—Ñ—Ä–æ–Ω—Ç (Vite, /api –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π) | ‚úÖ –∫–∞–±–∑–¥–∞/tigrit_web/frontend; deploy/tigrit_web |
| –î–µ–ø–ª–æ–π: tigrit-api, tigrit-web –≤ docker-compose; nginx server tigrit.stakingphxpw.com | ‚úÖ deploy/docker-compose.149.yml, nginx-docker.conf |

### –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
| –ü–æ—Ç–æ–∫ (25) | –°—Ç–∞—Ç—É—Å |
|------------|--------|
| –ß–µ–∫–∏–Ω ‚Üí –ø–æ–ø—ã—Ç–∫–∏ (checkin_state, checkin_log, attempts_balance) | ‚úÖ |
| –®–∞—Ö—Ç–∞: mine_create, mine_dig ‚Üí economy_ledger (–º–æ–Ω–µ—Ç—ã) | ‚úÖ |
| –î—Ä–æ–ø –≤ –ø—Ä–∏–∑–æ–≤–æ–π —è—á–µ–π–∫–µ –ø–æ prizeCellLoot (relic/amulet/coins/egg) | ‚úÖ –∑–∞–ø–∏—Å—å –≤ user_items/player_eggs/economy_ledger |

### –ë–î –∏ API –ø–æ –ø–ª–∞–Ω—É (—Ñ–∞–∑ 1‚Äì10)
- –ü—Ä–µ–¥–º–µ—Ç—ã –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å: item_defs, user_items, eggs_def, player_eggs; GET /balances, /inventory.
- –ó–¥–∞–Ω–∏—è: buildings_def, player_field, user_buildings, building_slots, demolish_log; field, place, demolish, upgrade, equip, unequip, collect.
- –ö—Ä–∞—Ñ—Ç: crafting_log; POST /craft/merge, /upgrade, /reroll.
- –†—ã–Ω–æ–∫: market_orders, escrow, trade_offers; –æ—Ä–¥–µ—Ä–∞ –∏ –æ—Ñ—Ñ–µ—Ä—ã.
- –í—ã–≤–æ–¥: user_wallets, withdraw_gating, token_compliance, donations, ad_log; GET /withdraw/eligibility, POST /withdraw/request (–∑–∞–≥–ª—É—à–∫–∞), /ads/view, /donate.
- –°—Ç–µ–π–∫–∏–Ω–≥/–±–ª–æ–∫—á–µ–π–Ω: staking_sessions, staking_reward_history, token_transactions; GET /staking/sessions, POST /staking/create (–∑–∞–≥–ª—É—à–∫–∞).
- –°–æ–±—ã—Ç–∏—è –∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã: game_events, leaderboards; GET /leaderboards.
- –ê–¥–º–∏–Ω/—Ä–∏—Å–∫: risk_profile, user_sanctions, admin_users (—Ç–∞–±–ª–∏—Ü—ã).

### –ê–¥–º–∏–Ω: –∫–∞–Ω–∞–ª—ã, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —á–∞—Ç–µ, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| admin_get_channels, admin_add_channel, admin_delete_channel | ‚úÖ |
| check_user_in_chat(chat_id, user_id) (Telegram getChatMember) | ‚úÖ infrastructure/telegram_chat.py, –Ω—É–∂–µ–Ω BOT_TOKEN |
| activity_log_record (message_sent, reaction_received ‚Üí activity_log + user_activity_stats) | ‚úÖ |
| admin_get_activity_log, admin_get_activity_stats | ‚úÖ |
| API: GET/POST/DELETE /api/admin/channels, GET /api/admin/check-user-in-chat, POST/GET activity | ‚úÖ |

### –§—É–Ω–∫—Ü–∏–∏ 18_Dev (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
- ensure_user(telegram_id) ‚Üí user_id  
- ensure_balance_row(user_id, currency)  
- checkin (–∫–∞–∫ do_checkin: CD, granted attempts, state/log)  
- mine_create ‚Üí mine_id  
- mine_dig (–ø–æ–ø—ã—Ç–∫–∞, –æ—Ç–∫—Ä—ã—Ç–∏–µ —è—á–µ–π–∫–∏, –¥—Ä–æ–ø, dig_log, economy_ledger –¥–ª—è coins)  

---

## –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)

### –ó–∞–≥–ª—É—à–∫–∏ / –Ω–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| **–í—ã–≤–æ–¥ TON** | POST /withdraw/request –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ¬´iCryptoCheck not configured¬ª; —Ä–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ iCryptoCheck transfer/withdrawal –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω |
| **–°—Ç–µ–π–∫–∏–Ω–≥** | POST /staking/create ‚Äî –∑–∞–≥–ª—É—à–∫–∞; –Ω–µ—Ç –≤—ã–∑–æ–≤–∞ iCryptoCheck payment-addresses; –Ω–µ—Ç –∫—Ä–æ–Ω-–Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞–≥—Ä–∞–¥, —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ LOCKED‚ÜíUNSTAKED, –∞–≤—Ç–æ—Ä–µ–∏–Ω–≤–µ—Å—Ç–∞ |
| **–ë–ª–æ–∫—á–µ–π–Ω-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | –ù–µ—Ç –º–æ–¥—É–ª—è monitor_wallets() / process_transaction(); TonAPI –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è; —Ç–∞–±–ª–∏—Ü–∞ token_transactions –ø—É—Å—Ç–∞—è; –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—é verify:/ref: –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **–ö—Ä–æ–Ω-–∑–∞–¥–∞—á–∏** | –ù–µ—Ç –≤–æ—Ä–∫–µ—Ä–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é: —Å—Ç–µ–π–∫–∏–Ω–≥ (–∫–∞–∂–¥—ã–π —á–∞—Å), –±–ª–æ–∫—á–µ–π–Ω (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω), Skyfall, –ø–µ—Ä–µ—Å—á—ë—Ç leaderboards |

### –ë–î ‚Äî —Ç–∞–±–ª–∏—Ü—ã –∏–∑ 18_Dev, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç
| –î–æ–º–µ–Ω | –¢–∞–±–ª–∏—Ü—ã | –°—Ç–∞—Ç—É—Å |
|-------|---------|--------|
| –ü–æ—Ä—á–∏/—ç—Ñ—Ñ–µ–∫—Ç—ã | curse_log, user_effects, effect_defs | ‚ùå |
| –ö—ç—à –¥–æ–Ω–∞—Ç–æ–≤ | donation_leaderboard_cache | ‚ùå |
| –ê–¥–º–∏–Ω/–∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ | user_identities, account_links, access_policy, user_flags | ‚ùå |
| –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ | currencies, exchange_rates | ‚ùå |

### –§—É–Ω–∫—Ü–∏–∏ 18_Dev (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)
- **exchange_currency** ‚Äî –æ–±–º–µ–Ω –≤–∞–ª—é—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä ‚≠ê‚Üîüíé)
- **toggle_ads**, **get_ads_income_mult** ‚Äî –≤–∫–ª/–≤—ã–∫–ª —Ä–µ–∫–ª–∞–º—ã –∏ –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–æ—Ö–æ–¥–∞
- **can_admin**, **link_accounts_manual**, **unlink_accounts**, **get_account_links**, **auto_link_by_identity** ‚Äî –∞–¥–º–∏–Ω-–ø—Ä–∏–≤—è–∑–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

### –ö–æ–Ω—Ñ–∏–≥ game_rules
- **ads_rules** (enabledIncomeMultIfAdsOff, checkinCdBonus, dailyAdCap) ‚Äî –Ω–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- **donation_rules**, **withdraw_credit_rules** ‚Äî –Ω–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ

### –õ–æ–≥–∏–∫–∞ –∏ –ø–æ—Ç–æ–∫–∏
| –ß—Ç–æ | –°—Ç–∞—Ç—É—Å |
|-----|--------|
| –£—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ (‚â•3) | –í eligibility –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω level_ok=True; –Ω–µ—Ç —Ä–∞—Å—á—ë—Ç–∞ —É—Ä–æ–≤–Ω—è –∏–∑ exp |
| –≠—Ä—ã/—Å–µ–∑–æ–Ω—ã | –ù–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –º–µ–∂–¥—É —ç—Ä–∞–º–∏ (25%/30%), –Ω–µ—Ç —Ä–∞—Å—á—ë—Ç–∞ period_key (weekly/monthly/era), –Ω–µ—Ç –≤—ã–ø–ª–∞—Ç —Ç–æ–ø-3 –∏–∑ payout_pool |
| Skyfall | –ù–µ—Ç —Ç–∏–∫–æ–≤ –ø–æ—Ç–µ—Ä—å –ø–æ —Å—É–±–±–æ—Ç–∞–º (06_–ü–∞–¥–µ–Ω–∏–µ_–Ω–µ–±–∞) |
| –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ leaderboards | –¢–∞–±–ª–∏—Ü–∞ –µ—Å—Ç—å, GET /leaderboards –æ—Ç–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ –ø–µ—Ä–µ—Å—á—ë—Ç/–∞–≥—Ä–µ–≥–∞—Ü–∏—è –æ—á–∫–æ–≤ –ø–æ —Å–æ–±—ã—Ç–∏—è–º –Ω–µ –∑–∞–≤—è–∑–∞–Ω—ã (–Ω–µ—Ç –∫—Ä–æ–Ω/—Ç—Ä–∏–≥–≥–µ—Ä–æ–≤) |

---

## –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º

1. **dig_log** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ drop_item_def_id, drop_rarity, egg_hit, ip_hash, device_hash, vpn_flag; –ª–æ–≥–∏–∫–∞ –∏—Ö –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –µ—Å—Ç—å –≤ mine_dig.
2. **checkin_log** ‚Äî –ø–æ–ª–µ–π ip_hash, device_hash, vpn_flag, risk_note –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –Ω–µ—Ç; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å –∫–ª–∏–µ–Ω—Ç–∞ –≤ POST /checkin.
3. **–õ—É—Ç —à–∞—Ö—Ç—ã** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω: –∑–∞–ø–∏—Å—å –≤ user_items, player_eggs, economy_ledger –ø–æ —Ç–∏–ø—É –¥—Ä–æ–ø–∞.

---

## –ò—Ç–æ–≥

| –ë–ª–æ–∫ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –ü–æ –¥–æ–∫—É–º–µ–Ω—Ç—É |
|------|-------------|--------------|
| –ö–æ–Ω—Ñ–∏–≥, —á–µ–∫–∏–Ω, —à–∞—Ö—Ç–∞, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, –∑–¥–∞–Ω–∏—è, –∫—Ä–∞—Ñ—Ç, —Ä—ã–Ω–æ–∫ | –î–∞ | –î–∞ |
| –í—ã–≤–æ–¥ (–ø—Ä–æ–≤–µ—Ä–∫–∏, eligibility, –¥–æ–Ω–∞—Ç—ã, —Ä–µ–∫–ª–∞–º–∞) | –¢–∞–±–ª–∏—Ü—ã + API, –±–µ–∑ iCryptoCheck | –ó–∞–≥–ª—É—à–∫–∞ |
| –°—Ç–µ–π–∫–∏–Ω–≥ (—Å–µ—Å—Å–∏–∏, —Ç–∞–±–ª–∏—Ü—ã) | –¢–∞–±–ª–∏—Ü—ã + GET/POST –∑–∞–≥–ª—É—à–∫–∏ | –ë–µ–∑ –∫—Ä–æ–Ω –∏ iCryptoCheck |
| –ë–ª–æ–∫—á–µ–π–Ω, –∫—Ä–æ–Ω, —ç—Ä—ã/–≤—ã–ø–ª–∞—Ç—ã —Ç–æ–ø-3, Skyfall | –¢–∞–±–ª–∏—Ü—ã / GET leaderboards | –ù–µ—Ç –ª–æ–≥–∏–∫–∏ –∏ –≤–æ—Ä–∫–µ—Ä–æ–≤ |
| iCryptoCheck, TonAPI | –ù–µ—Ç | –ù–µ—Ç |
| –ü–æ—Ä—á–∏, effect_defs, –∞–¥–º–∏–Ω-—Å–≤—è–∑–∫–∏, exchange_currency, game_rules (ads/donation/withdraw_credit) | –ù–µ—Ç | –ù–µ—Ç |
