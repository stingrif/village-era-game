# –î–µ–ø–ª–æ–π –Ω–∞ stakingphxpw.com

## –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (—Ñ–µ–≤—Ä–∞–ª—å 2026)

### –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –°–µ—Ä–≤–∏—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------|----------|
| `EDITOR_API_KEY` | tigrit-api | –ö–ª—é—á —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–∞—Ä—Ç—ã (`X-API-Key` –≤ PUT /api/map) |
| `TIGRIT_ADMIN_API_KEY` | tigrit-api | –ö–ª—é—á Admin API (`X-Admin-Key`) |
| `CORS_ORIGINS` | tigrit-api | –í–∫–ª—é—á–∏—Ç—å `https://tigrit.stakingphxpw.com` |

–î–æ–±–∞–≤–∏—Ç—å –≤ `–±—ç–∫–µ–Ω–¥/.env`:
```bash
EDITOR_API_KEY=your-editor-key
TIGRIT_ADMIN_API_KEY=your-admin-key
CORS_ORIGINS=https://stakingphxpw.com,https://www.stakingphxpw.com,https://tigrit.stakingphxpw.com
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –¥–µ–ø–ª–æ–µ–º)

```bash
# –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker exec stakingphxpw-tigrit-api python3 backend/run_migrations.py
```

–õ–æ–≥–∏: `[OK] 001_tigrit_village_extend.sql [OK] 002_tigrit_interactions_ensure.sql`

–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ ‚Äî –±–µ–∑ –æ—à–∏–±–æ–∫ (`ADD COLUMN IF NOT EXISTS` –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω).

### –í–∫–ª–∞–¥–∫–∞ –ê–¥–º–∏–Ω

- –û—Ç–∫—Ä—ã—Ç—å `https://tigrit.stakingphxpw.com` ‚Üí –≤–∫–ª–∞–¥–∫–∞ üõ°Ô∏è –ê–¥–º–∏–Ω
- –í–≤–µ—Å—Ç–∏ `TIGRIT_ADMIN_API_KEY` –≤ –ø–æ–ª–µ ¬´Admin API Key¬ª
- –§–æ—Ä–º–∞ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ –¥–µ—Ä–µ–≤–Ω–∏
- –ö–Ω–æ–ø–∫–∏ disabled –±–µ–∑ –∫–ª—é—á–∞
- –ë—ã—Å—Ç—Ä—ã–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å—Ç—Ä–æ–π–∫—É, –∑–∞–ª–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã, –ø–æ–¥–Ω—è—Ç—å —É—Ä–æ–≤–µ–Ω—å

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è/30_Admin_API_–¢–∏–≥—Ä–∏—Ç.md`

---

## –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∫–∞–±–∑–¥–∞

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ **–∫–∞–±–∑–¥–∞** —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ deploy:

```bash
# –∏–∑ –ø–∞–ø–∫–∏ –ò–≥—Ä–∞/deploy (–∏–ª–∏ –∏–∑ –∫–æ—Ä–Ω—è: bash –ò–≥—Ä–∞/deploy/sync_from_cabzda.sh)
bash sync_from_cabzda.sh
```

–°–∫—Ä–∏–ø—Ç:
- –∫–æ–ø–∏—Ä—É–µ—Ç –≤ `tigrit_api/backend/data/`: `tile_data.json`, `building_data.json`, `character_data.json`, `village_map.json` –∏–∑ `–∫–∞–±–∑–¥–∞/tigrit_web/backend/data/`;
- –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–ø–∏—é —Ñ—Ä–æ–Ω—Ç–∞ –≤ `tigrit_web/frontend/` (index.html, package.json, src/ –∏ —Ç.–¥.) –∏–∑ `–∫–∞–±–∑–¥–∞/tigrit_web/frontend/`.

–û–∂–∏–¥–∞–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: —Ä—è–¥–æ–º —Å –ø–∞–ø–∫–æ–π `–ò–≥—Ä–∞/` –ª–µ–∂–∏—Ç –ø–∞–ø–∫–∞ `–∫–∞–±–∑–¥–∞/`. –ò–ª–∏ –∑–∞–¥–∞—Ç—å –ø—É—Ç—å: `CABZDA=/–ø—É—Ç—å/–∫/–∫–∞–±–∑–¥–∞ bash sync_from_cabzda.sh`.

–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã (docker build).

---

## –ß–µ–∫-–ª–∏—Å—Ç (–ø–æ –ø–ª–∞–Ω—É)

1. **–§—Ä–æ–Ω—Ç:** –≤ `config.js` –∑–∞–¥–∞–Ω–æ `window.GAME_API_BASE = 'https://stakingphxpw.com/api'`.
2. **–ë—ç–∫–µ–Ω–¥:** –≤ `–ò–≥—Ä–∞/–±—ç–∫–µ–Ω–¥/.env` –¥–æ–±–∞–≤–∏—Ç—å:
   ```bash
   CORS_ORIGINS=https://stakingphxpw.com,https://www.stakingphxpw.com
   ```
3. **–†–æ—É—Ç–µ—Ä:** –ø—Ä–æ–±—Ä–æ—Å 80 –∏ 443 –Ω–∞ IP –º–∞—à–∏–Ω—ã, –≥–¥–µ –∫—Ä—É—Ç–∏—Ç—Å—è nginx (–Ω–∞–ø—Ä–∏–º–µ—Ä 192.168.1.247).
4. **DNS:** A-–∑–∞–ø–∏—Å—å stakingphxpw.com (–∏ www) –Ω–∞ –≤–Ω–µ—à–Ω–∏–π IP —Ä–æ—É—Ç–µ—Ä–∞.
5. **–°–µ—Ä–≤–µ—Ä:** nginx + SSL + –±—ç–∫–µ–Ω–¥ (uvicorn –Ω–∞ 8000).

## Nginx

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ `nginx-stakingphxpw.conf`.
- –ó–∞–º–µ–Ω–∏—Ç—å `/var/www/stakingphxpw` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –∏–≥—Ä–æ–π (–≤ –Ω–µ–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `village-era-game-final.html`, `config.js`, `frontend/`).
- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ –≤ `/etc/nginx/sites-available/`, —Å–æ–∑–¥–∞—Ç—å —Å–∏–º–ª–∏–Ω–∫ –≤ `sites-enabled`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `nginx -t`, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å nginx.
- SSL: `certbot --nginx -d stakingphxpw.com -d www.stakingphxpw.com` (–∏–ª–∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫ 443 –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∏ —É–∫–∞–∑–∞—Ç—å –ø—É—Ç–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º).

## –ë—ç–∫–µ–Ω–¥

–ù–∞ —Ç–æ–π –∂–µ –º–∞—à–∏–Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç—å API:

```bash
cd /–ø—É—Ç—å/–∫/–ò–≥—Ä–∞/–±—ç–∫–µ–Ω–¥
./venv/bin/uvicorn api.main:app --host 127.0.0.1 --port 8000
```

–ò–ª–∏ —á–µ—Ä–µ–∑ systemd/supervisor –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞.

## –¢–∏–≥—Ä–∏—Ç-–∫–ª–∏–µ–Ω—Ç (tigrit.stakingphxpw.com)

–°—Ç–∞—Ç–∏–∫–∞ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–∞ –¢–∏–≥—Ä–∏—Ç —Ä–∞–∑–¥–∞—ë—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É **https://tigrit.stakingphxpw.com** —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `tigrit-web`, –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤ `docker-compose.149.yml` (–≤ —Å–≤—è–∑–∫–µ —Å nginx-—à–ª—é–∑–æ–º).

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `deploy/tigrit_web/frontend/` (HTML, JS, CSS) –Ω—É–∂–Ω–æ:

```bash
# –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (–ò–≥—Ä–∞/)
bash deploy/deploy_docker_on_149.sh
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker compose -f deploy/docker-compose.149.yml up -d --build` ‚Äî –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ `tigrit-web` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —É–∂–µ –≤—Ö–æ–¥—è—Ç.

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

```bash
# –§—Ä–æ–Ω—Ç –¢–∏–≥—Ä–∏—Ç ‚Äî –æ–∂–∏–¥–∞–µ—Ç—Å—è 200
curl -s -o /dev/null -w "%{http_code}" -H "Host: tigrit.stakingphxpw.com" http://127.0.0.1:8081/

# API village ‚Äî 200 –∏–ª–∏ 404
curl -s -o /dev/null -w "%{http_code}" -H "Host: tigrit.stakingphxpw.com" http://127.0.0.1:8081/api/village

# Health ‚Äî {"status":"ok"}
curl -s -H "Host: tigrit.stakingphxpw.com" http://127.0.0.1:8081/api/health

# –ï–¥–∏–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ ‚Äî –º–∞—Å—Å–∏–≤ –∏–∑ 122+ –æ–±—ä–µ–∫—Ç–æ–≤
curl -s -H "Host: tigrit.stakingphxpw.com" http://127.0.0.1:8081/api/items-catalog | python3 -c "import sys,json; d=json.load(sys.stdin); print(len(d), '–ø—Ä–µ–¥–º–µ—Ç–æ–≤')"
```

---

## Telegram Web App (–∫–Ω–æ–ø–∫–∞ ¬´–ò–≥—Ä–∞¬ª –≤ –±–æ—Ç–µ)

- **URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞ (BotFather ‚Üí Menu Button –∏–ª–∏ web_app-–∫–Ω–æ–ø–∫–∞):** `https://stakingphxpw.com` –∏–ª–∏ `https://stakingphxpw.com/village-era-game-final.html` ‚Äî —Ç–æ—Ç –∞–¥—Ä–µ—Å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–≥—Ä–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ HTTPS** ‚Äî Telegram –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Web App –ø–æ HTTP (–∫—Ä–æ–º–µ localhost –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏). –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º (–Ω–µ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π).
- **CORS:** –≤ –±—ç–∫–µ–Ω–¥–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã origins `https://web.telegram.org` –∏ `https://t.me`, –∑–∞–ø—Ä–æ—Å—ã –∫ API –∏–∑ Telegram –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å.
- –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ¬´–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç¬ª: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ —ç—Ç–æ–º—É URL —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ HTTPS –∏ —á—Ç–æ –Ω–µ—Ç 404/500 –Ω–∞ —Å–∞–º–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ –Ω–∞ `config.js`.
